<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AlsaDuo – Tour interactive</title>
    <!-- Google Fonts for a premium feel -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Base reset */
      *, *::before, *::after {
        box-sizing: border-box;
      }
      html, body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        background: #f5efe6; /* soft cream background, matching the logo */
        color: #063c3c; /* dark green for text */
        font-family: 'Inter', sans-serif;
      }
      /* Loader overlay */
      #loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background: #f5efe6;
        z-index: 20;
        transition: opacity 1s ease;
      }
      #loader.fade-out {
        opacity: 0;
        pointer-events: none;
      }
      .spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(6,60,60,0.2);
        border-top-color: #063c3c;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .brand {
        margin-top: 1rem;
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        letter-spacing: 0.05rem;
        color: #063c3c;
      }
      .logo {
        width: 160px;
        height: auto;
        margin-bottom: 1rem;
      }
      /* Canvas styling */
      #webgl {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        outline: none;
        z-index: 0;
      }
      /* Section overlay container */
      #sections {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        z-index: 10;
      }
      .section {
        position: absolute;
        width: 80%;
        max-width: 800px;
        text-align: center;
        font-family: 'Playfair Display', serif;
        font-weight: 400;
        font-size: clamp(1.5rem, 4vw, 3rem);
        line-height: 1.3;
        opacity: 0;
        transform: translateY(50px);
        transition: opacity 0.7s ease, transform 0.7s ease;
        padding: 1rem;
        color: #063c3c;
      }
      .section.active {
        opacity: 1;
        transform: translateY(0);
      }
      /* Scroll container to enable scroll-driven animation */
      #scroll-area {
        position: relative;
        width: 100%;
        height: 300vh;
        z-index: 1;
      }
      /* Responsive adjustments */
      @media (max-width: 600px) {
        .logo { width: 120px; }
        .brand { font-size: 1.5rem; }
        .section { font-size: clamp(1.2rem, 5vw, 2rem); }
      }
    </style>
  </head>
  <body>
    <!-- Loader with brand elements -->
    <div id="loader">
      <img class="logo" src="logoalsaduo.png" alt="AlsaDuo" />
      <div class="spinner"></div>
      <div class="brand">AlsaDuo</div>
    </div>
    <!-- Three.js canvas -->
    <canvas id="webgl"></canvas>
    <!-- Overlaid text sections -->
    <div id="sections">
      <div id="section1" class="section">
        Découvrez notre minaret emblématique, symbole de tradition et d'élégance.
      </div>
      <div id="section2" class="section">
        Explorez les saveurs et les histoires d'Alsace à travers AlsaDuo.
      </div>
      <div id="section3" class="section">
        Rejoignez-nous pour une expérience unique mêlant culture et gourmandise.
      </div>
    </div>
    <!-- Scroll area to capture scroll progress -->
    <div id="scroll-area"></div>
    <!-- Three.js and GLTF loader scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
    <script>
      // Helper for smooth interpolation
      function lerp(a, b, t) {
        return a + (b - a) * t;
      }
      // Global variables
      let scene, camera, renderer, model;
      const canvas = document.getElementById('webgl');
      const loaderOverlay = document.getElementById('loader');
      const sections = [
        document.getElementById('section1'),
        document.getElementById('section2'),
        document.getElementById('section3'),
      ];
      // Scroll progress (0 to 1)
      let scrollProgress = 0;
      // Parallax values
      let targetX = 0,
        targetY = 0;
      let currentX = 0,
        currentY = 0;
      function init() {
        // Scene setup
        scene = new THREE.Scene();
        // Camera
        camera = new THREE.PerspectiveCamera(
          45,
          window.innerWidth / window.innerHeight,
          0.1,
          100
        );
        camera.position.set(0, 1.5, 4);
        // Renderer
        renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        // Lighting
        const hemi = new THREE.HemisphereLight(0xffffff, 0xcccccc, 1.0);
        hemi.position.set(0, 1, 0);
        scene.add(hemi);
        const dir = new THREE.DirectionalLight(0xffffff, 0.8);
        dir.position.set(5, 10, 7.5);
        scene.add(dir);
        // Load model
        const manager = new THREE.LoadingManager();
        manager.onLoad = function () {
          // Hide loader when everything is loaded
          loaderOverlay.classList.add('fade-out');
          setTimeout(() => {
            loaderOverlay.style.display = 'none';
          }, 1000);
        };
        const gltfLoader = new THREE.GLTFLoader(manager);
        gltfLoader.load(
          'minaret_model.glb',
          function (gltf) {
            model = gltf.scene;
            model.traverse(function (child) {
              if (child.isMesh) {
                child.castShadow = true;
                child.receiveShadow = true;
              }
            });
            // Compute bounding box to scale and center the model
            const box = new THREE.Box3().setFromObject(model);
            const size = new THREE.Vector3();
            box.getSize(size);
            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 2.5 / maxDim;
            model.scale.setScalar(scale);
            // Center the model vertically
            box.setFromObject(model);
            const center = new THREE.Vector3();
            box.getCenter(center);
            model.position.x -= center.x;
            model.position.y -= (center.y - size.y * scale * 0.5);
            model.position.z -= center.z;
            scene.add(model);
          },
          undefined,
          function (error) {
            console.error('Error loading GLB:', error);
          }
        );
        // Event listeners
        window.addEventListener('resize', onResize);
        // Parallax on pointer move
        window.addEventListener('pointermove', function (event) {
          const x = (event.clientX / window.innerWidth) * 2 - 1;
          const y = (event.clientY / window.innerHeight) * 2 - 1;
          targetX = x;
          targetY = y;
        });
        // Scroll detection
        window.addEventListener('scroll', updateScroll);
      }
      function updateScroll() {
        const scrollTop = window.scrollY;
        const docHeight = document.body.scrollHeight - window.innerHeight;
        scrollProgress = docHeight > 0 ? scrollTop / docHeight : 0;
        updateSections(scrollProgress);
      }
      function updateSections(progress) {
        const num = sections.length;
        sections.forEach((sec, idx) => {
          const start = idx / num;
          const end = (idx + 1) / num;
          const local = (progress - start) / (end - start);
          if (local >= 0 && local <= 1) {
            sec.classList.add('active');
          } else {
            sec.classList.remove('active');
          }
        });
      }
      function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
      function animate() {
        requestAnimationFrame(animate);
        // Smooth parallax interpolation
        currentX = lerp(currentX, targetX, 0.05);
        currentY = lerp(currentY, targetY, 0.05);
        // Apply parallax to camera
        camera.position.x = currentX * 0.6;
        camera.position.y = 1.5 + currentY * 0.5 - scrollProgress * 2.0;
        camera.lookAt(0, 0.5 - scrollProgress * 1.5, 0);
        // Rotate model based on scroll
        if (model) {
          const totalRotation = Math.PI * 2; // 360 degrees
          model.rotation.y = totalRotation * scrollProgress;
        }
        renderer.render(scene, camera);
      }
      init();
      animate();
    </script>
  </body>
</html>